\clearpage
<!--
to do onboarding sa4ss - move this to sa4ss.sty so everyone's figures hold their order
https://stackoverflow.com/questions/29696172/how-to-hold-figure-position-with-figure-caption-in-pdf-output-of-knitr
-->
\floatplacement{figure}{H}
# Figures

## Data figures

```{r, setup-plotinfotable}
figurecsv <- utils::read.csv(
  file.path(params$model, "plots", "plotinfotable_for_doc.csv")
)
```

```{r, results = "asis"}
do.call(
  sa4ss::add_figure,
  utils::read.csv(file.path("..", "figures", "map_of_stock_boundaries_40-10.csv"))
)
```

![Length (cm) versus age (year) and associated von Bertalanffy growth curves (lines) by latitude (color). Models were fit to data from Lam research samples and West Coast Groundfish Bottom Trawl Survey data.\label{fig:Lam-vbgfcurves}](../figures/Lam-vbgfcurves.pdf){width=100% height=100% alt="Size-at-age increases with increasing latitude."}

![Estimated smoother of latitude (decimal degrees) for age-7 female fish when fitting length-at-age data.\label{fig:Lam-kapurage7latitude}](../figures/Lam-kapurage7latitude.png){width=100% height=100% alt="Change point was estimated at 38 degrees N latitude."}


<!-- ====================================================================== -->
<!-- 20Data figures -->
<!-- ====================================================================== -->

```{r, results = "asis"}
add_figure_ling(csv=figurecsv, "data_plot$")
```

```{r, catch-figures, results = "asis"}
# Arrange figures in order of the time they were modified
add_figure_ling(dplyr::bind_rows(mapply(
  FUN = utils::read.csv,
  file = dir(file.path("..","figures"), pattern = "^catch-.+\\.csv",full.names=TRUE),
  SIMPLIFY = FALSE
)) %>% dplyr::arrange(file.info(filein)$mtime)
)
```

```{r, results = "asis"}
do.call(
  sa4ss::add_figure,
  utils::read.csv(file.path(params$model, "custom_plots", "index_data_all_fleets.csv"))
)
```


```{r, cpue-figures-north, results = "asis", opts.label = "north", echo = FALSE}
# Use figures-cpue.csv to bring in ordered set of figures
figures_cpuedata <- utils::read.csv(file.path("..", "figures", "figures_cpue.csv"))
add_figure_ling(figures_cpuedata %>% dplyr::filter(grepl("cpue-commercialfixed", label)))
add_figure_ling(utils::read.csv(file.path("..", "figures", "reccpuewa.csv")))
add_figure_ling(figures_cpuedata %>% dplyr::filter(grepl("cpue-recreationalOregon", label)))
```

<!-- WCGBTS -->

```{r, echo=FALSE, results='asis'}
nm = "WCGBTS_presence_absence_by_depth_bin.png"
sa4ss::add_figure(
filein = file.path("..", "figures", nm),
caption = paste0("Presence/absence of ", spp, " in the  \\glsentrylong{s-wcgbt} (\\glsentryshort{s-wcgbt}) by 25 m depth increments"),
label = 'wcgbts-presAbs')
```

<!-- WCGBTS -->

```{r, results = "asis"}
ignore <- mapply(FUN = sa4ss::add_figure,
  filein = file.path("..", "figures",
    paste0("WCGBTS - ", params$area, " _", c("Length", "Age"), "_Frequency.png")),
  caption = paste0(c("Length", "Age"), "-frequency data for males and females in the \\glsentrylong{s-wcgbt} (\\glsentryshort{s-wcgbt})."),
  label = paste0("wcbts-", c("len", "age"), "Comp")
)
ignore <- mapply(FUN = sa4ss::add_figure,
  filein = file.path("..", "figures",
    paste0("Triennial - ", params$area, " _", c("Length", "Age"), "_Frequency.png")),
  caption = paste0(c("Length", "Age"), "-frequency data for males and females in the \\glsentrylong{s-tri} (\\glsentryshort{s-tri})."),
  label = paste0("tri-", c("len", "age"), "Comp")
)
```

<!-- Triennial -->

```{r, echo=FALSE, results='asis', opts.label = 'south'}
nm = "Triennial_cpueXdepth.png"
sa4ss::add_figure(
filein = file.path("..", "figures", nm),
caption = paste0("Raw catch per unit effort in positive tows by depth in
                 the triennial survey"),
label = 'tri-depthSplit')
```

<!-- Hook and Line -->

```{r, echo=FALSE, results='asis', opts.label = 'south'}
ignore <- mapply(FUN = sa4ss::add_figure,
  filein = file.path("..", "figures",
    paste0(c(
      "HNL lengths Male-Female_Length",
      "HNL lengths Unsexed_Length",
      "Hook and Line_Age"
    ), "_Frequency.png")
  ),
  caption = paste0(
    c("Length", "Length", "Age"),
    "-frequency data for ",
    c("males and females ", "unsexed fish ", "males and females "),
    "in the ", sprintf("\\glsentrylong{s-%1$s} (\\glsentryshort{s-%1$s}).", "hkl")
  ),
  label = paste0("hkl-", c("len", "len", "age"), "Comp", c("-sexed", "-unsexed", ""))
)

```

<!-- Lam research -->

```{r, echo=FALSE, results='asis'}
nm = "Lam Thesis lengths Male-Female South_Length_Frequency.png"
sa4ss::add_figure(
filein = file.path("..", "figures", nm),
caption = "Length-frequency data for male and females from Lam Research data",
label = 'lam-lenComp')
nm = "Lam Thesis ages Male-Female South_Age_Frequency.png"
sa4ss::add_figure(
filein = file.path("..", "figures", nm),
caption = "Age-frequency data for male and females from Lam Research data",
label = 'lam-ageComp')
```

<!--- Oregon hook and line in marine reserves, index not used -->
```{r, results = "asis", opts.label = "north", echo = FALSE}
add_figure_ling(utils::read.csv(file.path("..", "figures", "figures-fi-index-ormarres.csv")))
```

<!-- ====================================================================== -->
<!-- Biology Figures -->
<!-- ====================================================================== -->

## Biology figures

```{r figures-biology, results = "asis"}
sa4ss::add_figure(
filein = file.path(
  "..", "figures",
  paste0("WCGBTS - ", params$area, " _length_fraction_female.png")
),
caption = "Fraction of the biological data from the \\gls{s-wcgbt} subset to just the area included in this assessment that are female by length (cm).",
label = "biology-sexratio-lengthfractionfemale")

sa4ss::add_figure(
filein = file.path("..", "figures", "biology_exploration", "Length_by_Latitude_JustCombo.png"),
caption = "Weight-length relationship for males and females from the WCGBTS",
label = "biology-sexratio-lengthbylatitude")
add_figure_ling(figurecsv %>% dplyr::filter(grepl("bio6_maturity", label)))
```
```{r, echo=FALSE, results='asis'}
nm = "Length_Weight_Combo_North.png"
sa4ss::add_figure(
filein = file.path("..", "figures", "biology_exploration", nm),
caption = "Weight-length relationship for males and females from the WCGBTS",
label = 'len-weight')
```

```{r, results = "asis"}
add_figure_ling(utils::read.csv(file.path("..", "figures", "ageing-double-reads.csv")))
```

<!-- ====================================================================== -->
<!-- Recreational Length and Age Comps -->
<!-- ====================================================================== -->

```{r, echo=FALSE, results='asis', opts.label = 'north'}
get_fleet("rec") %>%
  # Expand so each rec fleet has one row per sexes and types listed
  tidyr::crossing(sex = c("Sexed", "Unsexed"), type = c("Length", "Age")) %>%
  # Group lengths for a given fleet then ages
  dplyr::arrange(desc(type), order, sex) %>%
  # Keep only the appropriate fleets for the area
  dplyr::filter(!!as.name(paste0("used_", substr(Sys.Date(),1,4),".", tolower(substr(params$area,1,1))))) %>%
  # Create the caption and filename
  dplyr::mutate(
    alt_caption = "to do -- fill this in",
    filein = file.path(
      "..", "figures",
      paste0(
        ifelse(label_twoletter == "CA", paste(label_twoletter, params$area), label_twoletter),
        " Recreational - ",
        sex, "_", type,
        "_Frequency.png"
      )
    ),
    caption = paste0(stringr::str_to_title(type), "-frequency data for the ", label_twoletter, " recreational fleet for ", tolower(sex), " fish."),
    label = paste0(tolower(label_twoletter), "-", substr(tolower(type), 1, 3), "comp-", tolower(sex))
  ) %>%
  dplyr::filter(file.exists(filein)) %>%
  dplyr::select(filein, caption, label, alt_caption) %>%
  add_figure_ling
```


<!-- ====================================================================== -->
<!-- VAST -->
<!-- ====================================================================== -->

```{r figures-vast, results = "asis"}
ignore <- mapply(
  FUN = add_figure_vast,
  SIMPLIFY = FALSE,
  file.path("..", "data-raw",
    sprintf("%s_%s_gamma", c("WCGBTS", "Triennial"), params$area)
  )
)
```


<!-- ====================================================================== -->
<!-- ******************     Model results    ********** --> 
<!-- ====================================================================== -->

## Model results figures

### Growth and selectivity

```{r, results = "asis"}
do.call(
  sa4ss::add_figure,
  utils::read.csv(file.path(params$model, "custom_plots", "selectivity_comm.csv"))
)
```
```{r, results = "asis"}
do.call(
  sa4ss::add_figure,
  utils::read.csv(file.path(params$model, "custom_plots", "selectivity_noncomm.csv"))
)
```


### Fits to data

```{r, results = "asis"}
do.call(
  sa4ss::add_figure,
  utils::read.csv(file.path(params$model, "custom_plots", "index_fits_all_fleets.csv"))
)
```

### Time series figures

### Sensitivity analyses and retrospectives

```{r, figures-retro, echo = FALSE, results = "asis"}
add_figure_retro(params$model, 5)
```

### Likelihood profiles

```{r, figures-profile, echo = FALSE, results = "asis"}
add_figure_profile(params$model, "NatM")
add_figure_profile(params$model, "steep")
add_figure_profile(params$model, "R0")
```

### Reference points and forecasts

