
```{r reccpuewa-figures, opts.label = 'execute'}
#
#
#
gg <- ggplot2::ggplot(
  reccpuewa_SMcoefs %>% dplyr::mutate(names = factor(names, levels = names[order(Estimate)])) %>% 
  dplyr::filter(!grepl("Intercept", names)),
  ggplot2::aes(
    x = factor(names),
    y = Estimate
  )
) +
  ggplot2::geom_bar(position = ggplot2::position_dodge(), stat = "identity", fill = "blue") +
  ggplot2::geom_errorbar(
    ggplot2::aes(
      ymin = Estimate - 1.96 * Std..Error,
      ymax = Estimate + 1.96 * Std..Error
    ),
    width = 0.6, # Width of the error bars
    position = ggplot2::position_dodge(0.9)) +
    ggplot2::labs(
      x = "Species",
      y = paste0("Estimated co-occurrence with ", utils_name("common"))
    ) +
    ggplot2::coord_flip() +
    ggplot2::theme_bw()
ggsave2(
  gg,
  filename = file.path("..", "figures", "reccpuewa-filterSMcoef.png"),
  caption = paste0(
    "Estimates of species coefficients (blue bars) from the ",
    "binomial generalized linear model (GLM) ",
    "for presence/absence of ",
    utils_name("common"),
    " in the Washington recreational dockside interview data. ",
    "Horizontal black bars represent the 95\\% confidence intervals."
  ),
  alttext = paste0(
    reccpuewa_SMcoefs[1, "names"], " and ", dplyr::last(reccpuewa_SMcoefs[["names"]]),
    " are the most and least likely species to co-occur with ",
    utils_name("common"), " in the Washington recreational fishery."
  ),
  label = "reccpuewa-filterSMcoef"
)
#
#
#
grDevices::png(
  filename = file.path("..", "figures", "ScaledQQplot_pos.png"),
  width = 6, height = 3, units = "in", res = 300, pointsize=6
)
p_res <- DHARMa::simulateResiduals(fittedModel = mod_b, n = 500,integerResponse = T) # had to reduce n in order to run, hitting memory limit
plot(p_res, rank=TRUE, quantreg=TRUE)
grDevices::dev.off()
utils::write.csv(
  row.names = FALSE,
  data.frame(
    caption = "Scaled quantile-quantile (QQ) plot (left panel) and standardized residuals versus rank transformed model predictions (right panel) for the binomial response model fit using maximum likelihood for the Washington recreational index.",
    alt_caption = "Diagnostic tests reveal one to one relationship between expected and observed residuals.",
    label = "reccpuewa-mleqqscaled",
    filein = file.path("..", "figures", "ScaledQQplot_pos.png")
  ),
  file = file.path("..", "figures", "ScaledQQplot_pos.csv")
)
#
#
#
gg <- ggplot2::ggplot(
  data = as.data.frame(cbind(Median = coef(best_bin.glm_STAN), coef(mod_b))),
  ggplot2::aes(V2, Median)
) +
ggplot2::geom_point(pch = 1, cex = 2) +
ggplot2::geom_point(
  data = as.data.frame(cbind(Median = coef(best_pos.glm_STAN), coef(mod_l))),
  pch = 19, cex = 2
) +
ggplot2::geom_abline(intercept = 0, slope = 1) +
ggplot2::labs(
  x = "Maximum likelihood estimates of GLM parameters",
  y = "Median posterior GLM parameters"
) +
ggplot2::theme_bw()
ggsave2(
  gg,
  filename = file.path("..", "figures", "reccpuewa-filterSMcoef.png"),
  caption = paste0(
    "Comparison of estimates of the delta generalized linear model (GLM) ",
    "estimated using a maximum likelihood framework (x axis) and ",
    "Bayesian framework (y axis) for the binomial model (open circles) and ",
    "the positive model (closed circles) to a perfect relationship ",
    "(i.e., 1:1; solid line).",
  ),
  alttext = paste0(
    "Estimates fall on the one-to-one line for both models."
  ),
  label = "reccpuewa-mlevbayesian"
)
#
#
#
ggplot2::ggplot(index_MCMC, ggplot2::aes(year, obs)) +
ggplot2::geom_line(col = "black", size = 2) +
ggplot2::geom_ribbon(ggplot2::aes(ymin = HPD_lower, ymax = HPD_upper)) +
ggplot2::geom_line(col = "gray", size = 1,
  data = data.frame(year = as.numeric(names(index_mle)), obs = t(index_mle))
) +
ggplot2::labs(x = "Year", y = "Estimated index (todo units here)") +
ggplot2::geom_line(data = old, col = "red")
#
#
#
plot(stats::fitted(best_pos.glm_STAN),log(reccpuewa_dataforEM[reccpuewa_dataforEM[[colresponse]] > 0, "cpue"]),xlim=c(-5,2),ylim=c(-5,2),xlab="Expected value",ylab="ln(CPUE)")
lines(-5:5,-5:5)
plot(stats::fitted(best_pos.glm_STAN),resid(best_pos.glm_STAN),pch=20,cex=0.8,abline(0,0))
qqnorm(stats::resid(best_pos.glm_STAN),xlab="Quantiles of standard normal distribution",ylab="Residuals",xlim=c(-4,4),ylim=c(-4,4))
abline(0,1)
plot(fitted(best_pos.glm_STAN),sqrt(abs(resid(best_pos.glm_STAN))))
plot(best_pos.glm_STAN)
```

